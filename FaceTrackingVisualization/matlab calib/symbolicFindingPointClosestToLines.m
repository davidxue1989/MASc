p = sym('p', [3 1]);
p0 = sym('p0', [3 1]);
u = sym('u', [3 1]);

e = ((p-p0)-((p-p0).'*u)*u).'*((p-p0)-((p-p0).'*u)*u);
% e = ((p-p0)-((p-p0).'*u)*u)^2;
% e = ((p-p0)-dot((p-p0),u)*u)^2;

jacobian(e, p)
% =
% [ 2*(u1^2 - 1)*(p01 - p1 + u1*(u1*(p1 - p01) + u2*(p2 - p02) + u3*(p3 - p03))) + 2*u1*u2*(p02 - p2 + u2*(u1*(p1 - p01) + u2*(p2 - p02) + u3*(p3 - p03))) + 2*u1*u3*(p03 - p3 + u3*(u1*(p1 - p01) + u2*(p2 - p02) + u3*(p3 - p03))),
%   2*(u2^2 - 1)*(p02 - p2 + u2*(u1*(p1 - p01) + u2*(p2 - p02) + u3*(p3 - p03))) + 2*u1*u2*(p01 - p1 + u1*(u1*(p1 - p01) + u2*(p2 - p02) + u3*(p3 - p03))) + 2*u2*u3*(p03 - p3 + u3*(u1*(p1 - p01) + u2*(p2 - p02) + u3*(p3 - p03))), 
%   2*(u3^2 - 1)*(p03 - p3 + u3*(u1*(p1 - p01) + u2*(p2 - p02) + u3*(p3 - p03))) + 2*u1*u3*(p01 - p1 + u1*(u1*(p1 - p01) + u2*(p2 - p02) + u3*(p3 - p03))) + 2*u2*u3*(p02 - p2 + u2*(u1*(p1 - p01) + u2*(p2 - p02) + u3*(p3 - p03)))];
 
d = 2*(u*u.' - eye(3))^2*(p-p0)

simplify(d - jacobian(e,p).')
%  = 0

%%
% redo
u = sym('u', [3, 1])
p = sym('p', [3, 1])
po = sym('po', [3, 1])

e = norm((p-po-((p-po).'*u)*u))^2
simplify(jacobian(e, p))
%= [ 2*(u1^2 - 1)*(po1 - p1 + u1*(u1*(p1 - po1) + u2*(p2 - po2) + u3*(p3 - po3))) + 2*u1*u2*(po2 - p2 + u2*(u1*(p1 - po1) + u2*(p2 - po2) + u3*(p3 - po3))) + 2*u1*u3*(po3 - p3 + u3*(u1*(p1 - po1) + u2*(p2 - po2) + u3*(p3 - po3))), 2*(u2^2 - 1)*(po2 - p2 + u2*(u1*(p1 - po1) + u2*(p2 - po2) + u3*(p3 - po3))) + 2*u1*u2*(po1 - p1 + u1*(u1*(p1 - po1) + u2*(p2 - po2) + u3*(p3 - po3))) + 2*u2*u3*(po3 - p3 + u3*(u1*(p1 - po1) + u2*(p2 - po2) + u3*(p3 - po3))), 2*(u3^2 - 1)*(po3 - p3 + u3*(u1*(p1 - po1) + u2*(p2 - po2) + u3*(p3 - po3))) + 2*u1*u3*(po1 - p1 + u1*(u1*(p1 - po1) + u2*(p2 - po2) + u3*(p3 - po3))) + 2*u2*u3*(po2 - p2 + u2*(u1*(p1 - po1) + u2*(p2 - po2) + u3*(p3 - po3)))]
simplify(jacobian(e, p).' - 2*(u*u.'-eye(3))^2*(p-po))
% = [0; 0; 0]